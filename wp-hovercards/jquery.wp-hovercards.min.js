/*
	Plugin Name: WordPress Hovercards
	Plugin URI: http://github.com/bilawal360/wordpress-hovercards
	Description: Enable post & pages hovercards within your WordPress blog.
	Author: Bilawal Hameed
	Author URI: http://www.bilawal.co.uk
	License: GPLv2
	Version: 1.0.1
*/

var WP_Hovercards={version:"1.0.1",is_busy:false,cache:new Array,html:function(a,b){var c;c="<div class='content"+b.post.post_custom_class+"'";if(b.post.post_image){c+=" style='background-image:url("+b.post.post_timthumb+"&w=700&h=200&zc=1&f=0";if(b.post.post_custom_class.indexOf("nogblur")==-1){c+="|8"}if(b.post.post_custom_class.indexOf("negate")>-1){c+="|1"}if(b.post.post_custom_class.indexOf("bw")>-1){c+="|2"}c+=");'"}c+="> <h3>"+b.post.post_title+"</h3>";c+="<div class='excerpt'><p>"+b.post.post_excerpt+"</p></div>";c+="<div class='details'><ul><li>Posted: "+b.post.post_date+"</li><li>Category: "+b.post.post_category_single+"</li><li>"+b.post.post_comments+" Comments</li></ul></div>";c+="<div class='wp'></div>";return c+"</div>"},response:function(a,b,c,d){a=a.replace("?wp_hovercards=json","");if(jQuery("div.wp-hovercards-root").length==0){return}if(a==(parent.document.location||document.location)){return}if(d.version!==WP_Hovercards.version){}if(d.res!=="success"){WP_Hovercards.cache[a]=d;return}jQuery("div.wp-hovercards-root").show().css({top:c.pageY+25+"px",left:c.clientX-17+"px"});jQuery(document).mousemove(function(a){jQuery("div.wp-hovercards-root").show().css({top:a.pageY+25+"px",left:a.clientX-17+"px"})});jQuery("div.wp-hovercards-root").html(WP_Hovercards.html(b,d));if(typeof WP_Hovercards.cache[a]==="undefined"){WP_Hovercards.cache[a]=d}},clear:function(a,b){if(jQuery(a).data("title")){jQuery(a).attr("title",jQuery(a).data("title"))}jQuery(document).unbind("mousemove");jQuery("div.wp-hovercards-root").hide().empty()},call:function(a,b){var c=jQuery(a).attr("href")||"";if(c.indexOf("#")>=0){c=c.split("#");c=c[0]}if(typeof WP_Hovercards.cache[c]!=="undefined"){return WP_Hovercards.response(c,a,b,WP_Hovercards.cache[c])}if(WP_Hovercards.is_busy!=false){WP_Hovercards.is_busy.abort();WP_Hovercards.is_busy=false}WP_Hovercards.is_busy=jQuery.getJSON(c+"?wp_hovercards=json",function(d){WP_Hovercards.response(c,a,b,d)})},init:function(){if(typeof jQuery==="undefined"){console.log("jQuery Library needed to run WordPress Hovercards.");return}jQuery("body").append("<div class='wp-hovercards-root'></div>");jQuery.expr[":"].internal=function(a,b,c,d){var e=jQuery(a).attr("href")||"";var f="http://"+document.location.host+"/";var g="http";var h=0;if(e.substr(0,g.length)===g&&e.indexOf("/wp-admin/")===-1&&e.indexOf("/wp-content/")===-1){if(e.substring(0,f.length)===f){h=1}}else if(e.indexOf(":")==-1){h=1}return h};var a="";if(jQuery(".entry-content").length){a=".entry-content "}else if(jQuery(".post-content").length){a=".post-content "}else if(jQuery(".content").length){a=".content "}else if(jQuery("#content").length){a="#content "}jQuery(a+"a:internal:not(.disable), a.hovercards:internal, a#hovercards:internal").mouseenter(function(a){var b=jQuery(this);if(b.attr("title")){b.data("title",b.attr("title")).removeAttr("title")}WP_Hovercards.call(b,a)}).mouseleave(function(a){WP_Hovercards.clear(jQuery(this),a)})}};jQuery(document).ready(function(){WP_Hovercards.init()})